# Workflow name
name: Build
on:
  # When it will be triggered
  # And in which branch
  pull_request:
  push:
    branches:
      - develop
# Where will they run
jobs:
  build:

    runs-on: ubuntu-latest

## Checkout our repository ###
- name: Checkout
  uses: actions/checkout@v2.3.3

- name: Set up our JDK environment
  uses: actions/setup-java@v1.4.3
  with:
    java-version: 1.8

## Build all our Build Types at once ##
- name: Build all artifacts
  id: buildAllApks
  uses: eskatos/gradle-command-action@v1.3.3
  with:
    gradle-version: current
    wrapper-cache-enabled: true
    dependencies-cache-enabled: true
    configuration-cache-enabled: true
    arguments: assembleDebug

## Running the tests
  - name: Run Kotlin Linter
    run: ./gradlew ktlintStagingDebugCheck

  - name: Run Unit Tests
    run: ./gradlew testStagingDebugUnitTest
## Get the artifacts
  - name: Upload our APK
    uses: actions/upload-artifact@v2.2.0
    with:
      name: Release artifact
      path: app/build/outputs/apk/debug/app-debug-*.apk
## Create  a release on github
  - name: Create Release
    id: create_release
    uses: actions/create-release@v1
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    with:
      tag_name: ${{ github.ref }}
      release_name: Release ${{ github.ref }}
      draft: false
      prerelease: false